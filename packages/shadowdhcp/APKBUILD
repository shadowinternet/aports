# Maintainer: Mackenzie Hauck <mackenzie@shadowinternet.ca>
pkgname=shadowdhcp
pkgver=0.1.1
pkgrel=1
pkgdesc="Reservation-only DHCPv4/DHCPv6 server"
url="https://github.com/shadowinternet/shadowdhcp"
arch="x86_64"
license="MIT AND Apache-2.0"
depends="libcap-utils"
pkgusers="shadowdhcp"
pkggroups="shadowdhcp"
install="$pkgname.pre-install $pkgname.post-install $pkgname.post-upgrade"
source="
	shadowdhcp-$pkgver-linux-musl::https://github.com/shadowinternet/shadowdhcp/releases/download/v$pkgver/shadowdhcp-linux-musl
	shadowdhcp.initd
	shadowdhcp.logrotate
	config.json
	ids.json
	reservations.json
"
options="!check"  # No test suite for binary package

# Output to shadow-aports repo structure
export REPODEST="$HOME/packages/shadow-aports"

package() {
	# Install binary
	install -Dm755 "$srcdir/shadowdhcp-$pkgver-linux-musl" "$pkgdir/usr/bin/shadowdhcp"

	# Install OpenRC service
	install -Dm755 "$srcdir/shadowdhcp.initd" "$pkgdir/etc/init.d/shadowdhcp"

	# Install logrotate config
	install -Dm644 "$srcdir/shadowdhcp.logrotate" "$pkgdir/etc/logrotate.d/shadowdhcp"

	# Install default configuration
	install -Dm640 -g shadowdhcp "$srcdir/config.json" "$pkgdir/etc/shadowdhcp/config.json"
	install -Dm640 -g shadowdhcp "$srcdir/ids.json" "$pkgdir/etc/shadowdhcp/ids.json"
	install -Dm640 -g shadowdhcp "$srcdir/reservations.json" "$pkgdir/etc/shadowdhcp/reservations.json"

	# Create log directory
	install -dm750 -o shadowdhcp -g shadowdhcp "$pkgdir/var/log/shadowdhcp"
}

sha512sums="
6f47a551f2d5884fefaf98e9aa4ebd116f9a9c592ad0e54175445b0233f734ae036ab74aea84bd26af8a0681ebcdbd7d2e65d8db62df1b8d7957e464248d4b8c  shadowdhcp-0.1.1-linux-musl
fa2913c1b2524e8dd688d31180dcb2f75cb3ffd7bc5b9779e452c43656ff0c5708f20645931e04b3a54a8bfd89be9e721b5baf0b35b6a67187f4c2067db0ac47  shadowdhcp.initd
bb31bd7742efad80f2d23bc027370345247677d2d7e24da8eb5dd2f74e4d02a96cea95e935f12266e4b8bd1217eb8f6cb4d7ef147ad5e8ef0b961b3f3ba2a2d5  shadowdhcp.logrotate
bb0f5844179447ecf90ceb5747a3241cd7df6aa66e97fc6c1e8e08d40e675930f2d65fb35700be0ee55ad92ab465e0458105ca15f69c5475bcd65d74fe360368  config.json
2c8d4871740833517bf28732de33a8f022bebf6141a73d7cfb361c218d29fb1d5c8f61caa37de84be61e8fcf77a9feefd220c575a3a909d4852de1115ebcbb16  ids.json
b7a9336ed3a424b5d4d59d9b20d0bbc33217207b584db6b758fddb9a70b99e7c8c9f8387ef318a6b2039e62f09a3a2592bf5c76d6947a6ea1d107b924d7461f4  reservations.json
"
